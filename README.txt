# ThreatModel
Macros for Threat model generation by methodic FSTEC from 05.02.21

1. В программе представлены 5 режимов работы, которые выбираются при открытии файла:
1.1. Режим "Разработчик" (кнопка слева):
-Доступна кнопка "Выбор листа"
-Часть функций могут работать некорректно, т.к. переход между страницами подразумевает создание/обновление данных в памяти
-Если выбрать один из первых листов (для соответсвующих режимов) можно воспроизвести работу макроса от лица пользователя
1.2. Режим "Построение модели угроз"
-Перемещает на первую страницу для построения модели угроз
-Переход между этапами производится по нажатиям кнопки "Далее" и "Назад"
-ВАЖНО! Когда нажимается кнопка "Далее" данные на открываемой странице перезаписываются, т.е. внесенные на ней изменения не сохранятся.
-В ячейке А1 указано описание страницы.
-На последней странице ("Приложение 11") имеется кнопка "Сгенерировать приложения", которая сформирует приложения для модели угроз, которые прикладываются к файлу модели.
1.3. Режим "Построение мер защиты по модели угроз"
-ВАЖНО! При построении модели угроз дополнительные меры предлагаются на основе АКТУАЛЬНЫХ угроз
-Переход между этапами производится по нажатиям кнопки "Далее" и "Назад"
-ВАЖНО! Когда нажимается кнопка "Далее" данные на открываемой странице перезаписываются, т.е. внесенные на ней изменения не сохранятся.
-В ячейке А1 указано описание страницы.
-Если выбран приказ 239 в качестве опорного документа, то можно сгенерировать перечень требуемых и выполненных мер защиты для приложения к акту категорирования при завершеннии формирования мер. 
-ВАЖНО! Генерация производится с листа Order239 путём нажатия кнопки "Сгненерировать меры защиты для акта" на основе ЗАПОЛНЕННЫХ данных в столбце 7 ("Мера реализована?")
-На листах Order* указывается синим цветом добавленная мера, а красным - удалённая.
1.4. Режим "Отображение результата построения мер защиты"
-Отображает листы, которые можно использовать в документах для обоснования выбранных мер защиты
1.5. Режим "Отображение приложений модели угроз"
-Отображает листы, которые являются приложениями к модели угроз\
2. Макрос предполагает кастомизацию:
2.1 Иерархия построена по принципу: Словарь→Справочник→Таблица
2.1.1 Словарь: представляет собой набор соответствий "Описание"→ID, представлены на соотвествующих листах в списке листов МУ, а также на приложениях 3 и 4.
2.1.2. Справочник: Задаёт соответствия вида ID1→ID2|ID3....|IDN, представлены на соотвествующих листах в списке листов МУ. В него пишутся только актуальные ID на основе опросников и предзаполненных данных.
-Справочники заполняются на этих жи листах.
-Для получения актуального справочника надо нажать кнопку "Сформировать опросник"
-Для сохранения заполненного опрсоника нажать кнопку "Заполнить словарь"
2.1.3. Таблица: является объектом вида "коллекция", где хранится весь список этапов атак (нарушитель, уровень, категория, объект, интерфейс, вид реализации, способ реализации, актуальные угрозы и техники)
2.2. Для основных элементов созданы классы:
2.2.1. Threat - класс для угроз. Поля класса соответствуют листу "БДУ ФСТЭК"
-Поля заполняются на листе "Заполнение справочной информации в БДУ"
-Лист "Заполнение справочной информации в БДУ" обновляется при вручном вводе номера УБИ или при нажатии кнопок ">>>"/"<<<"
-Для сохранения введённой инормации надо нажать кнопку "Запись в лист BDU"
2.2.2. Technique - класс для техник. Поля класса соответствуют листу "База техник"
-Поля заполняются на листе "Заполнение справочной информации в базу техник"
-Лист "Заполнение справочной информации в базу техник" обновляется при вручном вводе номера УБИ или при нажатии кнопок ">>>"/"<<<"
-Для сохранения введённой инормации надо нажать кнопку "Запись в лист базы техник"
2.2.2. Measure - класс для мер. Поля описывают ID меры, её категроию и актуальность. Заполняется на основе выбранного опорного документа.
3. Известные проблемы:
3.1. Для Office365  есть проблема: для сигнализации  о завершении длительных этапов я использовал звуковой сигнал. Эта библиотека в Office365 не работает. Выдаёт ошибку.
-Можно удалить подключение библиотеки и функции вида Beep в модялх Base и Buttons
3.2. Долго работает: последние три этапа формирования МУ (и выгрузка приложений) занимают много времени из-за перебора всех вариантов. Может доходить до нескольких минут. 
-Решения нет. Это проблемы excel, связанные с обращением к ячейкам. Быстродействие можно улучшить, возможно, если перейти на БД или вообще сделать проект в нормальной IDE (типа Qt). Я сделал максимум из возможного: обращений к листам минимум, всё происходит через память.
